<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jiradown - Noah's Tools</title>
    <style>
        /* ===== Theme Variables ===== */
        :root {
            --color-bg: #f8f9fa;
            --color-surface: #ffffff;
            --color-text: #1a1a2e;
            --color-text-muted: #6c757d;
            --color-border: #dee2e6;
            --color-primary: #4a90e2;
            --color-primary-hover: #357abd;
            --color-error: #dc3545;
            --color-error-bg: #f8d7da;
            --color-success: #28a745;
            --shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
        }

        [data-theme="dark"] {
            --color-bg: #1a1a2e;
            --color-surface: #252542;
            --color-text: #e8e8e8;
            --color-text-muted: #a0a0a0;
            --color-border: #3d3d5c;
            --color-primary: #5c9ce6;
            --color-primary-hover: #7ab3f0;
            --color-error: #f87171;
            --color-error-bg: #3d2a2a;
            --shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
        }

        /* ===== Base Styles ===== */
        * { box-sizing: border-box; }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
                         Helvetica, Arial, sans-serif;
            background: var(--color-bg);
            color: var(--color-text);
            margin: 0;
            padding: 0;
            min-height: 100vh;
            line-height: 1.6;
            transition: background 0.3s, color 0.3s;
        }

        /* ===== Layout ===== */
        .site-header {
            background: var(--color-surface);
            border-bottom: 1px solid var(--color-border);
            padding: 12px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .site-logo {
            display: flex;
            align-items: center;
            gap: 10px;
            text-decoration: none;
            color: var(--color-text);
            font-weight: 600;
        }

        .site-logo img {
            height: 32px;
            width: auto;
        }

        .logo-dark { display: none; }
        .logo-light { display: block; }
        [data-theme="dark"] .logo-dark { display: block; }
        [data-theme="dark"] .logo-light { display: none; }

        .theme-toggle {
            background: var(--color-surface);
            border: 1px solid var(--color-border);
            border-radius: 6px;
            padding: 8px 12px;
            cursor: pointer;
            font-size: 16px;
            transition: background 0.2s;
        }

        .theme-toggle:hover {
            background: var(--color-bg);
        }

        main {
            max-width: 1400px;
            margin: 0 auto;
            padding: 24px 20px;
        }

        .tool-container {
            background: var(--color-surface);
            border-radius: 8px;
            padding: 24px;
            box-shadow: var(--shadow);
        }

        h1 {
            margin: 0 0 8px 0;
            font-size: 24px;
        }

        .tool-description {
            color: var(--color-text-muted);
            margin: 0 0 24px 0;
        }

        /* ===== Side by Side Layout ===== */
        .editor-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .editor-pane {
            display: flex;
            flex-direction: column;
        }

        .editor-pane label {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 6px;
            font-weight: 500;
        }

        .label-text {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .active-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--color-border);
            transition: background 0.2s;
        }

        .editor-pane.active .active-indicator {
            background: var(--color-success);
        }

        .button-group {
            display: flex;
            gap: 6px;
        }

        .editor-pane textarea {
            width: 100%;
            height: 500px;
            padding: 12px;
            border: 2px solid var(--color-border);
            border-radius: 6px;
            background: var(--color-bg);
            color: var(--color-text);
            font-family: 'Monaco', 'Menlo', 'Courier New', monospace;
            font-size: 14px;
            line-height: 1.5;
            resize: vertical;
            transition: border-color 0.2s;
        }

        .editor-pane textarea:focus {
            outline: none;
            border-color: var(--color-primary);
        }

        .editor-pane.active textarea {
            border-color: var(--color-primary);
        }

        /* ===== Buttons ===== */
        button {
            background: var(--color-primary);
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 500;
            transition: background 0.2s;
        }

        button:hover {
            background: var(--color-primary-hover);
        }

        button.secondary {
            background: var(--color-border);
            color: var(--color-text);
        }

        button.secondary:hover {
            background: var(--color-text-muted);
            color: white;
        }

        button.copied {
            background: var(--color-success);
        }

        /* ===== Reference Section ===== */
        .reference {
            margin-top: 24px;
            padding-top: 24px;
            border-top: 1px solid var(--color-border);
        }

        .reference h2 {
            font-size: 16px;
            margin: 0 0 12px 0;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .reference h2::before {
            content: 'â–¶';
            font-size: 10px;
            transition: transform 0.2s;
        }

        .reference.open h2::before {
            transform: rotate(90deg);
        }

        .reference-content {
            display: none;
            overflow-x: auto;
        }

        .reference.open .reference-content {
            display: block;
        }

        .reference table {
            width: 100%;
            border-collapse: collapse;
            font-size: 13px;
        }

        .reference th, .reference td {
            padding: 8px 12px;
            text-align: left;
            border-bottom: 1px solid var(--color-border);
        }

        .reference th {
            background: var(--color-bg);
            font-weight: 600;
        }

        .reference code {
            background: var(--color-bg);
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Monaco', 'Menlo', 'Courier New', monospace;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <header class="site-header">
        <a href="/" class="site-logo">
            <img src="../assets/logo-black-64.png" alt="" class="logo-light">
            <img src="../assets/logo-white-64.png" alt="" class="logo-dark">
            <span>Noah's Tools</span>
        </a>
        <button class="theme-toggle" id="themeToggle" aria-label="Toggle dark mode">
            ðŸŒ™
        </button>
    </header>

    <main>
        <article class="tool-container">
            <h1>Jiradown</h1>
            <p class="tool-description">Bidirectional conversion between Jira Server wiki markup and Markdown. Edit either side and the other updates in real-time.</p>

            <div class="editor-container">
                <div class="editor-pane" id="jiraPane">
                    <label>
                        <span class="label-text">
                            <span class="active-indicator"></span>
                            Jira Markup
                        </span>
                        <div class="button-group">
                            <button id="clearJiraBtn" class="secondary">Clear</button>
                            <button id="copyJiraBtn">Copy</button>
                        </div>
                    </label>
                    <textarea id="jiraInput" placeholder="h1. Heading
*bold* and _italic_
-strikethrough- and +underline+
{{monospace}} inline code

{code:javascript}
const hello = 'world';
{code}

# numbered list
## nested item
* bullet list
** nested item

[link text|https://example.com]
!image.png|alt=description!

||Header 1||Header 2||
|Cell 1|Cell 2|

{quote}
This is a blockquote
{quote}

{panel:title=Panel Title}
Panel content here
{panel}

[~username] mention
----"></textarea>
                </div>

                <div class="editor-pane" id="mdPane">
                    <label>
                        <span class="label-text">
                            <span class="active-indicator"></span>
                            Markdown
                        </span>
                        <div class="button-group">
                            <button id="clearMdBtn" class="secondary">Clear</button>
                            <button id="copyMdBtn">Copy</button>
                        </div>
                    </label>
                    <textarea id="mdInput" placeholder="# Heading
**bold** and *italic*
~~strikethrough~~ and underline
`monospace` inline code

```javascript
const hello = 'world';
```

1. numbered list
   1. nested item
- bullet list
  - nested item

[link text](https://example.com)
![description](image.png)

| Header 1 | Header 2 |
| --- | --- |
| Cell 1 | Cell 2 |

> This is a blockquote

@username mention
---"></textarea>
                </div>
            </div>

            <section class="reference" id="reference">
                <h2>Syntax Reference</h2>
                <div class="reference-content">
                    <table>
                        <thead>
                            <tr>
                                <th>Type</th>
                                <th>Jira</th>
                                <th>Markdown</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr><td>Headings</td><td><code>h1. Title</code> to <code>h6.</code></td><td><code># Title</code> to <code>######</code></td></tr>
                            <tr><td>Bold</td><td><code>*bold*</code></td><td><code>**bold**</code></td></tr>
                            <tr><td>Italic</td><td><code>_italic_</code></td><td><code>*italic*</code></td></tr>
                            <tr><td>Bold+Italic</td><td><code>*_text_*</code></td><td><code>***text***</code></td></tr>
                            <tr><td>Strikethrough</td><td><code>-text-</code></td><td><code>~~text~~</code></td></tr>
                            <tr><td>Underline</td><td><code>+text+</code></td><td><code>&lt;ins&gt;text&lt;/ins&gt;</code></td></tr>
                            <tr><td>Monospace</td><td><code>{{code}}</code></td><td><code>`code`</code></td></tr>
                            <tr><td>Superscript</td><td><code>^text^</code></td><td><code>&lt;sup&gt;text&lt;/sup&gt;</code></td></tr>
                            <tr><td>Subscript</td><td><code>~text~</code></td><td><code>&lt;sub&gt;text&lt;/sub&gt;</code></td></tr>
                            <tr><td>Code Block</td><td><code>{code:lang}...{code}</code></td><td><code>```lang...```</code></td></tr>
                            <tr><td>Links</td><td><code>[text|url]</code></td><td><code>[text](url)</code></td></tr>
                            <tr><td>Images</td><td><code>!url|alt=text!</code></td><td><code>![text](url)</code></td></tr>
                            <tr><td>Bullet List</td><td><code>* item</code></td><td><code>- item</code></td></tr>
                            <tr><td>Numbered List</td><td><code># item</code></td><td><code>1. item</code></td></tr>
                            <tr><td>Nested List</td><td><code>** or ##</code></td><td>2-space indent</td></tr>
                            <tr><td>Blockquote</td><td><code>{quote}...{quote}</code></td><td><code>> text</code></td></tr>
                            <tr><td>Table Header</td><td><code>||h1||h2||</code></td><td><code>| h1 | h2 |</code></td></tr>
                            <tr><td>Table Row</td><td><code>|c1|c2|</code></td><td><code>| c1 | c2 |</code></td></tr>
                            <tr><td>Horizontal Rule</td><td><code>----</code></td><td><code>---</code></td></tr>
                            <tr><td>Mentions</td><td><code>[~username]</code></td><td><code>@username</code></td></tr>
                        </tbody>
                    </table>
                </div>
            </section>
        </article>
    </main>

    <script src="../footer.js"></script>
    <script>
        // ===== Theme Toggle =====
        const themeToggle = document.getElementById('themeToggle');
        const html = document.documentElement;

        const savedTheme = localStorage.getItem('theme');
        const systemDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
        const initialTheme = savedTheme || (systemDark ? 'dark' : 'light');
        html.setAttribute('data-theme', initialTheme);
        themeToggle.textContent = initialTheme === 'dark' ? 'â˜€ï¸' : 'ðŸŒ™';

        themeToggle.addEventListener('click', () => {
            const current = html.getAttribute('data-theme');
            const next = current === 'dark' ? 'light' : 'dark';
            html.setAttribute('data-theme', next);
            localStorage.setItem('theme', next);
            themeToggle.textContent = next === 'dark' ? 'â˜€ï¸' : 'ðŸŒ™';
        });

        // ===== Reference Toggle =====
        const reference = document.getElementById('reference');
        reference.querySelector('h2').addEventListener('click', () => {
            reference.classList.toggle('open');
        });

        // ===== Conversion Functions =====

        function jiraToMarkdown(jira) {
            if (!jira) return '';
            let text = jira;

            // Preserve code blocks first
            const codeBlocks = [];
            text = text.replace(/\{code(?::([a-zA-Z0-9_+-]+))?(?:[:|](?:title|borderStyle|borderColor|bgColor|titleBGColor|titleColor)=[^}|]+)*\}([\s\S]*?)\{code\}/gi, (match, lang, code) => {
                codeBlocks.push({ lang: lang || '', code: code });
                return `__CODE_BLOCK_${codeBlocks.length - 1}__`;
            });

            // Preserve noformat blocks
            const noformatBlocks = [];
            text = text.replace(/\{noformat\}([\s\S]*?)\{noformat\}/gi, (match, content) => {
                noformatBlocks.push(content);
                return `__NOFORMAT_BLOCK_${noformatBlocks.length - 1}__`;
            });

            // Headings: h1. to h6.
            const headings = [];
            text = text.replace(/^h([1-6])\.\s*(.+)$/gm, (match, level, content) => {
                headings.push({ level: parseInt(level), content: content.trim() });
                return `__HEADING_${headings.length - 1}__`;
            });

            // Bold+Italic combo: *_text_* -> ***text***
            text = text.replace(/\*_([^_]+)_\*/g, '***$1***');
            text = text.replace(/_\*([^*]+)\*_/g, '***$1***');

            // Bold: *text* -> **text**
            text = text.replace(/(?<![a-zA-Z0-9*])\*([^\s*](?:[^*]*[^\s*])?)\*(?![a-zA-Z0-9*])/g, '**$1**');

            // Italic: _text_ -> *text*
            text = text.replace(/(?<![a-zA-Z0-9_])_([^\s_](?:[^_]*[^\s_])?)_(?![a-zA-Z0-9_])/g, '*$1*');

            // Strikethrough: -text- -> ~~text~~
            text = text.replace(/(?<![a-zA-Z0-9-])-([^\s-][^-]*[^\s-]|[^\s-])-(?![a-zA-Z0-9-])/g, '~~$1~~');

            // Underline: +text+ -> <ins>text</ins>
            text = text.replace(/(?<![a-zA-Z0-9+])\+([^\s+][^+]*[^\s+]|[^\s+])\+(?![a-zA-Z0-9+])/g, '<ins>$1</ins>');

            // Superscript: ^text^ -> <sup>text</sup>
            text = text.replace(/\^([^^]+)\^/g, '<sup>$1</sup>');

            // Subscript: ~text~ -> <sub>text</sub>
            text = text.replace(/(?<!~)~([^~]+)~(?!~)/g, '<sub>$1</sub>');

            // Monospace: {{text}} -> `text`
            text = text.replace(/\{\{([^}]+)\}\}/g, '`$1`');

            // Named links: [text|url] -> [text](url)
            text = text.replace(/\[([^\]|]+)\|([^\]]+)\]/g, '[$1]($2)');

            // Unnamed links: [url] -> <url> or [url](url)
            text = text.replace(/\[([^\]|]+)\]/g, (match, content) => {
                if (content.match(/^https?:\/\//)) {
                    return `<${content}>`;
                }
                return match;
            });

            // Images: !url! or !url|params! -> ![alt](url)
            text = text.replace(/!([^!\s|]+)(?:\|([^!]+))?!/g, (match, src, params) => {
                let alt = '';
                if (params) {
                    const altMatch = params.match(/alt=([^,|]+)/);
                    if (altMatch) alt = altMatch[1];
                }
                return `![${alt}](${src})`;
            });

            // Bullet lists with nesting
            text = text.replace(/^(\*+)\s+(.+)$/gm, (match, stars, content) => {
                const indent = '  '.repeat(stars.length - 1);
                return `${indent}- ${content}`;
            });

            // Numbered lists with nesting
            text = text.replace(/^(#+)\s+(.+)$/gm, (match, hashes, content) => {
                const indent = '  '.repeat(hashes.length - 1);
                return `${indent}1. ${content}`;
            });

            // Blockquote: bq. text -> > text
            text = text.replace(/^bq\.\s*(.+)$/gm, '> $1');

            // Quote blocks: {quote}...{quote}
            text = text.replace(/\{quote\}([\s\S]*?)\{quote\}/gi, (match, content) => {
                return content.trim().split('\n').map(line => `> ${line}`).join('\n');
            });

            // Panels: {panel:title=X}...{panel}
            text = text.replace(/\{panel(?::title=([^}|]+))?(?:\|[^}]*)?\}([\s\S]*?)\{panel\}/gi, (match, title, content) => {
                const lines = content.trim().split('\n').map(line => `> ${line}`);
                if (title) {
                    lines.unshift(`> **${title}**`, '>');
                }
                return lines.join('\n');
            });

            // Color tags: {color:red}text{color} -> text (strip colors)
            text = text.replace(/\{color:[^}]+\}([\s\S]*?)\{color\}/gi, '$1');

            // Tables
            text = text.replace(/((?:^[\t ]*\|.+\|[\t ]*$\n?)+)/gm, (tableBlock) => {
                const lines = tableBlock.trim().split('\n');
                const processedLines = [];
                let needsSeparator = false;
                let colCount = 0;

                for (const line of lines) {
                    const trimmedLine = line.trim();
                    // Header row: ||col||col||
                    if (trimmedLine.includes('||')) {
                        const cells = trimmedLine.split('||').filter(c => c !== '');
                        colCount = cells.length;
                        processedLines.push('| ' + cells.map(c => c.trim()).join(' | ') + ' |');
                        needsSeparator = true;
                    }
                    // Regular row: |col|col|
                    else if (trimmedLine.match(/^\|[^|]/)) {
                        if (needsSeparator && processedLines.length > 0) {
                            processedLines.push('|' + ' --- |'.repeat(colCount));
                            needsSeparator = false;
                        }
                        const cells = trimmedLine.split('|').filter((c, i, arr) => i > 0 && i < arr.length - 1);
                        processedLines.push('| ' + cells.map(c => c.trim()).join(' | ') + ' |');
                    }
                }

                // If only header rows with no data, still add separator
                if (needsSeparator && processedLines.length > 0) {
                    processedLines.push('|' + ' --- |'.repeat(colCount));
                }

                return processedLines.join('\n');
            });

            // Horizontal rule: ---- -> ---
            text = text.replace(/^-{4,}$/gm, '---');

            // Line breaks: \\ -> two trailing spaces + newline
            text = text.replace(/\\\\/g, '  \n');

            // Anchors and TOC: remove
            text = text.replace(/\{anchor:[^}]+\}/gi, '');
            text = text.replace(/\{toc(?::[^}]*)?\}/gi, '');

            // User mentions: [~username] -> @username
            text = text.replace(/\[~([^\]]+)\]/g, '@$1');

            // Restore headings
            headings.forEach((h, i) => {
                text = text.replace(`__HEADING_${i}__`, '#'.repeat(h.level) + ' ' + h.content);
            });

            // Restore code blocks
            codeBlocks.forEach((block, i) => {
                text = text.replace(`__CODE_BLOCK_${i}__`, '```' + block.lang + '\n' + block.code.trim() + '\n```');
            });

            // Restore noformat blocks
            noformatBlocks.forEach((content, i) => {
                text = text.replace(`__NOFORMAT_BLOCK_${i}__`, '```\n' + content.trim() + '\n```');
            });

            return text;
        }

        function markdownToJira(md) {
            if (!md) return '';
            let text = md;

            // Preserve code blocks first
            const codeBlocks = [];
            text = text.replace(/```([a-zA-Z0-9_+-]*)\n?([\s\S]*?)```/g, (match, lang, code) => {
                codeBlocks.push({ lang: lang || '', code: code });
                return `__CODE_BLOCK_${codeBlocks.length - 1}__`;
            });

            // Preserve inline code
            const inlineCodes = [];
            text = text.replace(/`([^`]+)`/g, (match, code) => {
                inlineCodes.push(code);
                return `__INLINE_CODE_${inlineCodes.length - 1}__`;
            });

            // Headers: # to ###### -> h1. to h6.
            text = text.replace(/^(#{1,6})\s+(.+)$/gm, (match, hashes, content) => {
                return `h${hashes.length}. ${content}`;
            });

            // Bold+Italic: ***text*** -> *_text_*
            text = text.replace(/\*{3}([^*]+)\*{3}/g, '*_$1_*');

            // Bold: **text** -> *text* (use placeholder to avoid italic match)
            const boldMatches = [];
            text = text.replace(/\*{2}([^*]+)\*{2}/g, (match, content) => {
                boldMatches.push(content);
                return `__BOLD_${boldMatches.length - 1}__`;
            });

            // Italic: *text* -> _text_
            text = text.replace(/(?<!\*)\*([^*]+)\*(?!\*)/g, '_$1_');

            // Restore bold
            boldMatches.forEach((content, i) => {
                text = text.replace(`__BOLD_${i}__`, `*${content}*`);
            });

            // Strikethrough: ~~text~~ -> -text-
            text = text.replace(/~~([^~]+)~~/g, '-$1-');

            // HTML tags
            text = text.replace(/<ins>([^<]+)<\/ins>/gi, '+$1+');
            text = text.replace(/<sup>([^<]+)<\/sup>/gi, '^$1^');
            text = text.replace(/<sub>([^<]+)<\/sub>/gi, '~$1~');

            // Links: [text](url) -> [text|url]
            text = text.replace(/\[([^\]]+)\]\(([^)]+)\)/g, '[$1|$2]');

            // Unnamed links: <url> -> [url]
            text = text.replace(/<(https?:\/\/[^>]+)>/g, '[$1]');

            // Images: ![alt](url) -> !url|alt=alt!
            text = text.replace(/!\[([^\]]*)\]\(([^)]+)\)/g, (match, alt, src) => {
                if (alt) {
                    return `!${src}|alt=${alt}!`;
                }
                return `!${src}!`;
            });

            // Tables - detect and convert
            text = text.replace(/((?:^\|.+\|$\n?)+)/gm, (tableBlock) => {
                const lines = tableBlock.trim().split('\n');
                const processedLines = [];
                let isFirstRow = true;

                for (const line of lines) {
                    // Skip separator rows
                    if (line.match(/^\|\s*[-:]+\s*\|/)) continue;

                    const cells = line.split('|').filter((c, i, arr) => i > 0 && i < arr.length - 1);

                    if (isFirstRow) {
                        // Header row
                        processedLines.push('||' + cells.map(c => c.trim()).join('||') + '||');
                        isFirstRow = false;
                    } else {
                        // Data row
                        processedLines.push('|' + cells.map(c => c.trim()).join('|') + '|');
                    }
                }

                return processedLines.join('\n');
            });

            // Blockquotes: > text -> {quote}...{quote} for multiline, bq. for single
            text = text.replace(/((?:^>.*$\n?)+)/gm, (quoteBlock) => {
                const lines = quoteBlock.trim().split('\n').map(l => l.replace(/^>\s?/, ''));
                if (lines.length === 1) {
                    return `bq. ${lines[0]}`;
                }
                return `{quote}\n${lines.join('\n')}\n{quote}`;
            });

            // Unordered lists with nesting
            text = text.replace(/^((?:  )*)[-*]\s+(.+)$/gm, (match, indent, content) => {
                const level = (indent.length / 2) + 1;
                return '*'.repeat(level) + ' ' + content;
            });

            // Ordered lists with nesting
            text = text.replace(/^((?:  )*)\d+\.\s+(.+)$/gm, (match, indent, content) => {
                const level = (indent.length / 2) + 1;
                return '#'.repeat(level) + ' ' + content;
            });

            // Horizontal rule: --- -> ----
            text = text.replace(/^-{3,}$/gm, '----');

            // User mentions: @username -> [~username]
            text = text.replace(/@([a-zA-Z0-9_.-]+)/g, '[~$1]');

            // Restore inline code: `code` -> {{code}}
            inlineCodes.forEach((code, i) => {
                text = text.replace(`__INLINE_CODE_${i}__`, `{{${code}}}`);
            });

            // Restore code blocks
            codeBlocks.forEach((block, i) => {
                if (block.lang) {
                    text = text.replace(`__CODE_BLOCK_${i}__`, `{code:${block.lang}}\n${block.code.trim()}\n{code}`);
                } else {
                    text = text.replace(`__CODE_BLOCK_${i}__`, `{code}\n${block.code.trim()}\n{code}`);
                }
            });

            return text;
        }

        // ===== UI State =====
        const jiraInput = document.getElementById('jiraInput');
        const mdInput = document.getElementById('mdInput');
        const jiraPane = document.getElementById('jiraPane');
        const mdPane = document.getElementById('mdPane');

        let isConverting = false;
        let activePane = null;

        function setActivePane(pane) {
            activePane = pane;
            jiraPane.classList.toggle('active', pane === 'jira');
            mdPane.classList.toggle('active', pane === 'md');
        }

        jiraInput.addEventListener('input', () => {
            if (isConverting) return;
            setActivePane('jira');
            isConverting = true;
            mdInput.value = jiraToMarkdown(jiraInput.value);
            isConverting = false;
        });

        mdInput.addEventListener('input', () => {
            if (isConverting) return;
            setActivePane('md');
            isConverting = true;
            jiraInput.value = markdownToJira(mdInput.value);
            isConverting = false;
        });

        jiraInput.addEventListener('focus', () => setActivePane('jira'));
        mdInput.addEventListener('focus', () => setActivePane('md'));

        // Copy buttons
        function copyWithFeedback(text, button) {
            navigator.clipboard.writeText(text).then(() => {
                const original = button.textContent;
                button.textContent = 'Copied!';
                button.classList.add('copied');
                setTimeout(() => {
                    button.textContent = original;
                    button.classList.remove('copied');
                }, 2000);
            });
        }

        document.getElementById('copyJiraBtn').addEventListener('click', () => {
            copyWithFeedback(jiraInput.value, document.getElementById('copyJiraBtn'));
        });

        document.getElementById('copyMdBtn').addEventListener('click', () => {
            copyWithFeedback(mdInput.value, document.getElementById('copyMdBtn'));
        });

        // Clear buttons
        document.getElementById('clearJiraBtn').addEventListener('click', () => {
            jiraInput.value = '';
            mdInput.value = '';
            jiraInput.focus();
        });

        document.getElementById('clearMdBtn').addEventListener('click', () => {
            jiraInput.value = '';
            mdInput.value = '';
            mdInput.focus();
        });
    </script>
</body>
</html>
