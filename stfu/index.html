<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="color-scheme" content="light dark">
    <title>STFU - Noah's Tools</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@2/css/pico.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/mshaugh/nerdfont-webfonts@v3.3.0/build/jetbrainsmono-nerd-font.css">
    <style>
        /* ===== Catppuccin Latte (Light) ===== */
        :root:not([data-theme="dark"]),
        [data-theme="light"] {
            --pico-background-color: #eff1f5;
            --pico-color: #4c4f69;
            --pico-muted-color: #9ca0b0;
            --pico-primary: #1e66f5;
            --pico-primary-hover: #1754c7;
            --pico-primary-focus: rgba(30, 102, 245, 0.25);
            --pico-primary-inverse: #ffffff;
            --pico-secondary: #8c8fa1;
            --pico-secondary-hover: #6c6f85;
            --pico-card-background-color: #ffffff;
            --pico-card-border-color: #ccd0da;
            --pico-card-sectioning-background-color: #e6e9ef;
            --pico-form-element-background-color: #ffffff;
            --pico-form-element-border-color: #ccd0da;
            --pico-form-element-focus-color: var(--pico-primary);
            --pico-code-background-color: #e6e9ef;
            --pico-code-color: #4c4f69;
            --pico-table-border-color: #ccd0da;
            --pico-muted-border-color: #ccd0da;
        }

        /* ===== Catppuccin Mocha (Dark) ===== */
        [data-theme="dark"] {
            --pico-background-color: #1e1e2e;
            --pico-color: #cdd6f4;
            --pico-muted-color: #a6adc8;
            --pico-primary: #89b4fa;
            --pico-primary-hover: #b4d0fb;
            --pico-primary-focus: rgba(137, 180, 250, 0.25);
            --pico-primary-inverse: #1e1e2e;
            --pico-secondary: #a6adc8;
            --pico-secondary-hover: #bac2de;
            --pico-card-background-color: #313244;
            --pico-card-border-color: #45475a;
            --pico-card-sectioning-background-color: #181825;
            --pico-form-element-background-color: #313244;
            --pico-form-element-border-color: #45475a;
            --pico-form-element-focus-color: var(--pico-primary);
            --pico-code-background-color: #181825;
            --pico-code-color: #cdd6f4;
            --pico-table-border-color: #45475a;
            --pico-muted-border-color: #45475a;
        }

        /* ===== Backward-compatible aliases for tool CSS ===== */
        :root, [data-theme="light"] {
            --color-bg: var(--pico-background-color);
            --color-surface: var(--pico-card-background-color);
            --color-text: var(--pico-color);
            --color-text-muted: var(--pico-muted-color);
            --color-border: var(--pico-card-border-color);
            --color-primary: var(--pico-primary);
            --color-primary-hover: var(--pico-primary-hover);
            --color-error: #d20f39;
            --color-error-bg: #fce4e8;
            --color-success: #40a02b;
            --shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
        }

        [data-theme="dark"] {
            --color-error: #f38ba8;
            --color-error-bg: #3d2a2a;
            --color-success: #a6e3a1;
            --shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
        }

        /* ===== Code font ===== */
        pre, code, kbd, samp, textarea[data-monospace],
        .monospace {
            font-family: 'JetBrains Mono Nerd Font', monospace;
        }

        /* ===== Header ===== */
        .site-header {
            background: var(--pico-card-background-color);
            border-bottom: 1px solid var(--pico-card-border-color);
            padding: 12px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .site-header .site-logo {
            display: flex;
            align-items: center;
            gap: 10px;
            text-decoration: none !important;
            color: inherit !important;
            font-weight: 600;
            font-size: 18px;
        }

        .site-logo img {
            height: 32px;
            width: auto;
        }

        .logo-dark { display: none; }
        .logo-light { display: block; }
        [data-theme="dark"] .logo-dark { display: block; }
        [data-theme="dark"] .logo-light { display: none; }

        .theme-toggle {
            background: var(--pico-card-background-color);
            border: 1px solid var(--pico-card-border-color);
            border-radius: 6px;
            padding: 8px 12px;
            cursor: pointer;
            font-size: 16px;
            color: var(--pico-color);
            transition: background 0.2s;
        }

        .theme-toggle:hover {
            background: var(--pico-background-color);
        }

        /* ===== Main ===== */
        main.container {
            --pico-container-max-width: 900px;
        }

        .tool-description {
            color: var(--pico-muted-color);
        }

        /* ===== Tool-specific styles ===== */
/* ===== Audio Visualizer ===== */
.visualizer-container {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 20px;
    margin-bottom: 24px;
}

.visualizer {
    display: flex;
    align-items: flex-end;
    justify-content: center;
    gap: 4px;
    height: 80px;
    padding: 10px;
}

.bar {
    width: 8px;
    background: var(--color-primary);
    border-radius: 4px;
    transition: height 0.1s ease;
    height: 10px;
}

.visualizer.active .bar {
    animation: pulse 0.5s ease-in-out infinite alternate;
}

.bar:nth-child(1) { animation-delay: 0s; }
.bar:nth-child(2) { animation-delay: 0.1s; }
.bar:nth-child(3) { animation-delay: 0.2s; }
.bar:nth-child(4) { animation-delay: 0.3s; }
.bar:nth-child(5) { animation-delay: 0.4s; }
.bar:nth-child(6) { animation-delay: 0.3s; }
.bar:nth-child(7) { animation-delay: 0.2s; }
.bar:nth-child(8) { animation-delay: 0.1s; }
.bar:nth-child(9) { animation-delay: 0s; }

@keyframes pulse {
    0% { height: 10px; opacity: 0.5; }
    100% { height: 60px; opacity: 1; }
}

.status {
    font-size: 18px;
    font-weight: 500;
    color: var(--color-text-muted);
}

.status.active {
    color: var(--color-success);
}

/* ===== Start Button ===== */
.start-button {
    width: 120px;
    height: 120px;
    border-radius: 50%;
    border: none;
    background: var(--color-primary);
    color: white;
    font-size: 48px;
    cursor: pointer;
    transition: transform 0.2s, background 0.2s, box-shadow 0.2s;
    box-shadow: 0 4px 20px rgba(74, 144, 226, 0.4);
}

.start-button:hover {
    transform: scale(1.05);
    background: var(--color-primary-hover);
}

.start-button.active {
    background: var(--color-error);
    box-shadow: 0 4px 20px rgba(220, 53, 69, 0.4);
}

.start-button.active:hover {
    background: #c82333;
}

/* ===== Controls ===== */
.controls {
    display: flex;
    flex-direction: column;
    gap: 20px;
    margin-top: 24px;
    padding-top: 24px;
    border-top: 1px solid var(--color-border);
}

.control-group {
    display: flex;
    flex-direction: column;
    gap: 8px;
}

.control-label {
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.control-label label {
    font-weight: 500;
}

.control-value {
    color: var(--color-primary);
    font-weight: 600;
    font-family: 'Monaco', 'Menlo', 'Courier New', monospace;
}

input[type="range"] {
    width: 100%;
    height: 8px;
    border-radius: 4px;
    background: var(--color-border);
    appearance: none;
    cursor: pointer;
}

input[type="range"]::-webkit-slider-thumb {
    appearance: none;
    width: 20px;
    height: 20px;
    border-radius: 50%;
    background: var(--color-primary);
    cursor: pointer;
    transition: transform 0.2s;
}

input[type="range"]::-webkit-slider-thumb:hover {
    transform: scale(1.2);
}

input[type="range"]::-moz-range-thumb {
    width: 20px;
    height: 20px;
    border-radius: 50%;
    background: var(--color-primary);
    cursor: pointer;
    border: none;
}

/* ===== Mode Toggle ===== */
.mode-toggle {
    display: flex;
    background: var(--color-bg);
    border-radius: 6px;
    padding: 4px;
    gap: 4px;
}

.mode-option {
    flex: 1;
    padding: 10px 16px;
    border: none;
    background: transparent;
    color: var(--color-text-muted);
    font-size: 14px;
    font-weight: 500;
    cursor: pointer;
    border-radius: 4px;
    transition: all 0.2s;
}

.mode-option:hover {
    color: var(--color-text);
}

.mode-option.active {
    background: var(--color-surface);
    color: var(--color-primary);
    box-shadow: var(--shadow);
}

/* ===== Error ===== */
.error {
    color: var(--color-error);
    background: var(--color-error-bg);
    padding: 12px;
    border-radius: 6px;
    margin-top: 16px;
    display: none;
}

.error.visible { display: block; }

/* ===== Info ===== */
.info {
    margin-top: 24px;
    padding: 16px;
    background: var(--color-bg);
    border-radius: 6px;
    font-size: 14px;
    color: var(--color-text-muted);
}

.info h3 {
    margin: 0 0 8px 0;
    font-size: 14px;
    color: var(--color-text);
}

.info ul {
    margin: 0;
    padding-left: 20px;
}

.info li {
    margin-bottom: 4px;
}

/* ===== Responsive ===== */
@media (max-width: 600px) {
    .start-button {
        width: 100px;
        height: 100px;
        font-size: 40px;
    }
    .mode-toggle {
        flex-direction: column;
    }
}

    </style>
</head>
<body>
    <header class="site-header">
        <a href="/" class="site-logo">
            <img src="../assets/logo-black-64.png" alt="" class="logo-light">
            <img src="../assets/logo-white-64.png" alt="" class="logo-dark">
            <span>Noah's Tools</span>
        </a>
        <button class="theme-toggle" id="themeToggle" aria-label="Toggle dark mode">
            üåô
        </button>
    </header>

    <main class="container">
        <article>
            <h1>STFU</h1>
            <p class="tool-description">Audio feedback looper that captures microphone input and plays it back with a configurable delay. Features two modes: Simple Delay (hear yourself once after a delay) and Echo Loop (audio repeats and gradually fades). The delayed auditory feedback (DAF) effect can disrupt speech fluency, making it useful for... encouraging others to be quiet. Works best with headphones to prevent actual audio feedback loops.</p>
<div class="visualizer-container">
    <div class="visualizer" id="visualizer">
        <div class="bar"></div>
        <div class="bar"></div>
        <div class="bar"></div>
        <div class="bar"></div>
        <div class="bar"></div>
        <div class="bar"></div>
        <div class="bar"></div>
        <div class="bar"></div>
        <div class="bar"></div>
    </div>
    <button class="start-button" id="startBtn" aria-label="Start listening">‚ñ∂</button>
    <div class="status" id="status">Click to start</div>
</div>

<div id="error" class="error" role="alert"></div>

<section class="controls">
    <div class="control-group">
        <div class="control-label">
            <label>Mode</label>
        </div>
        <div class="mode-toggle">
            <button class="mode-option active" data-mode="delay">Simple Delay</button>
            <button class="mode-option" data-mode="echo">Echo Loop</button>
        </div>
    </div>

    <div class="control-group">
        <div class="control-label">
            <label for="delaySlider">Delay</label>
            <span class="control-value" id="delayValue">2.0s</span>
        </div>
        <input type="range" id="delaySlider" min="0.5" max="5" step="0.1" value="2">
    </div>

    <div class="control-group" id="echoControls" style="display: none;">
        <div class="control-label">
            <label for="decaySlider">Echo Decay</label>
            <span class="control-value" id="decayValue">40%</span>
        </div>
        <input type="range" id="decaySlider" min="0.1" max="0.8" step="0.05" value="0.4">
    </div>

    <div class="control-group">
        <div class="control-label">
            <label for="volumeSlider">Volume</label>
            <span class="control-value" id="volumeValue">80%</span>
        </div>
        <input type="range" id="volumeSlider" min="0.1" max="2" step="0.1" value="0.8">
    </div>
</section>

<div class="info">
    <h3>How it works</h3>
    <ul>
        <li><strong>Simple Delay:</strong> Plays back audio once after the set delay</li>
        <li><strong>Echo Loop:</strong> Audio repeats and fades with each echo</li>
        <li>The delayed auditory feedback (DAF) effect can disrupt speech fluency</li>
        <li>Works best with headphones to prevent actual audio feedback</li>
    </ul>
</div>

        </article>
    </main>

    <script src="../footer.js"></script>
    <script>
        // ===== Theme Toggle =====
        const themeToggle = document.getElementById('themeToggle');
        const html = document.documentElement;

        const savedTheme = localStorage.getItem('theme');
        const systemDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
        const initialTheme = savedTheme || (systemDark ? 'dark' : 'light');
        html.setAttribute('data-theme', initialTheme);
        themeToggle.textContent = initialTheme === 'dark' ? '‚òÄÔ∏è' : 'üåô';

        themeToggle.addEventListener('click', () => {
            const current = html.getAttribute('data-theme');
            const next = current === 'dark' ? 'light' : 'dark';
            html.setAttribute('data-theme', next);
            localStorage.setItem('theme', next);
            themeToggle.textContent = next === 'dark' ? '‚òÄÔ∏è' : 'üåô';
        });
    </script>
    <script>
// ===== Audio Feedback Looper =====
const startBtn = document.getElementById('startBtn');
const statusEl = document.getElementById('status');
const visualizer = document.getElementById('visualizer');
const errorEl = document.getElementById('error');
const delaySlider = document.getElementById('delaySlider');
const delayValue = document.getElementById('delayValue');
const decaySlider = document.getElementById('decaySlider');
const decayValue = document.getElementById('decayValue');
const volumeSlider = document.getElementById('volumeSlider');
const volumeValue = document.getElementById('volumeValue');
const echoControls = document.getElementById('echoControls');
const modeButtons = document.querySelectorAll('.mode-option');

let audioContext = null;
let mediaStream = null;
let sourceNode = null;
let delayNode = null;
let feedbackGainNode = null;
let outputGainNode = null;
let isActive = false;
let currentMode = 'delay';

// Update display values
delaySlider.addEventListener('input', () => {
    delayValue.textContent = `${parseFloat(delaySlider.value).toFixed(1)}s`;
    if (delayNode) {
        delayNode.delayTime.value = parseFloat(delaySlider.value);
    }
});

decaySlider.addEventListener('input', () => {
    decayValue.textContent = `${Math.round(parseFloat(decaySlider.value) * 100)}%`;
    if (feedbackGainNode) {
        feedbackGainNode.gain.value = parseFloat(decaySlider.value);
    }
});

volumeSlider.addEventListener('input', () => {
    volumeValue.textContent = `${Math.round(parseFloat(volumeSlider.value) * 100)}%`;
    if (outputGainNode) {
        outputGainNode.gain.value = parseFloat(volumeSlider.value);
    }
});

// Mode toggle
modeButtons.forEach(btn => {
    btn.addEventListener('click', () => {
        modeButtons.forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        currentMode = btn.dataset.mode;
        echoControls.style.display = currentMode === 'echo' ? 'flex' : 'none';

        // Rebuild audio graph if active
        if (isActive) {
            rebuildAudioGraph();
        }
    });
});

function showError(msg) {
    errorEl.textContent = msg;
    errorEl.classList.add('visible');
}

function hideError() {
    errorEl.classList.remove('visible');
}

function rebuildAudioGraph() {
    if (!audioContext || !sourceNode) return;

    // Disconnect existing nodes
    sourceNode.disconnect();
    if (delayNode) delayNode.disconnect();
    if (feedbackGainNode) feedbackGainNode.disconnect();
    if (outputGainNode) outputGainNode.disconnect();

    // Create new nodes
    delayNode = audioContext.createDelay(10);
    delayNode.delayTime.value = parseFloat(delaySlider.value);

    outputGainNode = audioContext.createGain();
    outputGainNode.gain.value = parseFloat(volumeSlider.value);

    if (currentMode === 'echo') {
        // Echo mode: feedback loop
        feedbackGainNode = audioContext.createGain();
        feedbackGainNode.gain.value = parseFloat(decaySlider.value);

        sourceNode.connect(delayNode);
        delayNode.connect(feedbackGainNode);
        feedbackGainNode.connect(delayNode); // Feedback loop
        delayNode.connect(outputGainNode);
        outputGainNode.connect(audioContext.destination);
    } else {
        // Simple delay mode
        feedbackGainNode = null;
        sourceNode.connect(delayNode);
        delayNode.connect(outputGainNode);
        outputGainNode.connect(audioContext.destination);
    }
}

async function startListening() {
    hideError();

    try {
        mediaStream = await navigator.mediaDevices.getUserMedia({
            audio: {
                echoCancellation: false,
                noiseSuppression: false,
                autoGainControl: false
            }
        });

        audioContext = new (window.AudioContext || window.webkitAudioContext)();
        sourceNode = audioContext.createMediaStreamSource(mediaStream);

        rebuildAudioGraph();

        isActive = true;
        startBtn.textContent = '‚èπ';
        startBtn.classList.add('active');
        statusEl.textContent = 'Listening...';
        statusEl.classList.add('active');
        visualizer.classList.add('active');

    } catch (err) {
        console.error('Error accessing microphone:', err);
        if (err.name === 'NotAllowedError') {
            showError('Microphone access denied. Please allow microphone access to use this tool.');
        } else if (err.name === 'NotFoundError') {
            showError('No microphone found. Please connect a microphone.');
        } else {
            showError(`Error: ${err.message}`);
        }
    }
}

function stopListening() {
    if (mediaStream) {
        mediaStream.getTracks().forEach(track => track.stop());
        mediaStream = null;
    }

    if (audioContext) {
        audioContext.close();
        audioContext = null;
    }

    sourceNode = null;
    delayNode = null;
    feedbackGainNode = null;
    outputGainNode = null;

    isActive = false;
    startBtn.textContent = '‚ñ∂';
    startBtn.classList.remove('active');
    statusEl.textContent = 'Click to start';
    statusEl.classList.remove('active');
    visualizer.classList.remove('active');
}

startBtn.addEventListener('click', () => {
    if (isActive) {
        stopListening();
    } else {
        startListening();
    }
});

// Cleanup on page unload
window.addEventListener('beforeunload', stopListening);

    </script>
</body>
</html>
